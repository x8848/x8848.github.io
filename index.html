<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>5 min music plank</title>
    <style>
        label {
            cursor: pointer;
        }
    </style>
</head>
<body>
<audio id="beep" src="audio/beep.wav"></audio>
<audio id="end" src="audio/end.wav"></audio>
<audio id="count" src="audio/count.wav"></audio>
<audio id="go" src="audio/go.wav"></audio>
<audio id="thanks" src="audio/thanks.wav"></audio>
<audio id="applause" src="audio/applause.wav"></audio>
<audio id="song" src="audio/metallica.mp3"></audio>
<audio id="trauma" src="audio/trauma.mp3"></audio>

<button onclick="start()">start</button>
exercise: 1<span id="exercise"></span>

<div id="current" style="font-size: 220px">60</div>

<label>
    <input type="radio" name="radio" onclick="song=metallica;" checked>metallica
</label>
<label>
    <input type="radio" name="radio" onclick="song=trauma;">trauma worakls remix
</label>

<script>

    var song, interval, isNotPausedBefore;
    var exercise = document.getElementById("exercise");
    var exerciseCount = 1;

    var beep = document.getElementById("beep");
    var end = document.getElementById("end");
    var count = document.getElementById("count");
    var go = document.getElementById("go");
    var thanks = document.getElementById("thanks");
    var applause = document.getElementById("applause");
    var current = document.getElementById("current");

    var metallica = new Audio("audio/metallica.mp3");
    var trauma = new Audio("audio/trauma.mp3");

    song = metallica;

    function stop() {
        song.onpause = function () {
            thanks.play();
        };
        song.pause();
        song.currentTime = 0;
        exerciseCount = 1;
        clearInterval(interval);
        isNotPausedBefore = false;
		exercise.innerHTML = "";

        document.getElementsByTagName("button")[0].disabled=false;
        document.getElementsByTagName("input")[0].disabled=false;
        document.getElementsByTagName("input")[1].disabled=false;
    }

    function start() {
        interval = setInterval(render, 1000);
        song.onpause = function () {
            end.play();
            exerciseCount++;
            exercise.innerHTML = exercise.innerHTML + ", " + exerciseCount;
            isNotPausedBefore = false;
        };
        count.play();

        document.getElementsByTagName("button")[0].disabled=true;
        document.getElementsByTagName("input")[0].disabled=true;
        document.getElementsByTagName("input")[1].disabled=true;
    }

    function render() {
        var time = Math.round(song.currentTime);
        var seconds = time % 60;

        current.innerHTML = 60 - seconds;

        if (seconds == 30 || seconds == 55) {
            beep.play();
            isNotPausedBefore = true;
        }
        if (time == 5 * 60) {
            stop();
            return;
        }

        if (isNotPausedBefore && seconds == 0) {
            song.pause();
        }
    }

    end.onended = function () {
        count.play();
    };

    count.addEventListener("ended", function () {
        go.play();
    });

    go.onended = function () {
        song.play();
    };

    thanks.onended = function () {
        applause.play();
    };


</script>
</body>
</html>